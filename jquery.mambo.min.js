/*
 * Mambo jQuery Plugin
 * @author: Valerio Barrila aka NinjaTux
 * @twitter: ninjatux2k
 */(function(a,b,c,d){"use strict";function i(b,c){this.element=b;this.options=a.extend(!0,{},f,c);this._defaults=f;this._name=e;this.init()}var e="mambo",f={internalCircle:{line:"#000",fill:"#FF0000"},percentage:{drawUnfilled:!1,color:"#00FF00",unfilledColor:"#A6A6A6"},text:{textColor:"#FFF",displayValue:!0},drawShadow:!1},g=Math.PI/180,h=2*Math.PI;i.prototype.init=function(){if(this.checkCanvas()){this.context=this.element.getContext("2d");this.value=this.getValueDegrees();this.points=this.getPoints();a(this.element).css({width:this.points.width+"px",height:this.points.width+"px"});this.linesAndRadiuses=this.getLinesAndRadiuses();this.drawPercentage();this.options.percentage.drawUnfilled&&this.value!==360&&this.drawExtraPercentage();this.drawInternalCircle();this.options.drawShadow&&this.drawShadow();this.drawText()}};i.prototype.drawInternalCircle=function(){this.context.beginPath();this.context.moveTo(this.points.x,this.points.x);this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.internalRadius,0,h,!1);this.context.fillStyle=this.options.internalCircle.fill;this.context.lineWidth=this.linesAndRadiuses.internalLine;this.context.closePath();this.context.strokeStyle=this.options.internalCircle.line;this.context.stroke();this.context.fill()};i.prototype.drawPercentage=function(){this.context.beginPath();this.context.moveTo(this.points.x,this.points.x);this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.externalRadius,this.points.angle.start,this.points.angle.end,!1);this.context.closePath();this.context.fillStyle=this.options.percentage.color;this.context.fill()};i.prototype.drawExtraPercentage=function(){this.context.beginPath();this.context.moveTo(this.points.x,this.points.x);this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.externalRadius,this.points.angle.start,this.points.angle.end,!0);this.context.closePath();this.context.fillStyle=this.options.percentage.unfilledColor;this.context.fill()};i.prototype.drawShadow=function(){this.context.beginPath();this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.shadowRadius,0,h,!1);this.context.shadowColor="#cbcbcb";this.context.lineWidth=this.linesAndRadiuses.shadowLine;this.context.strokeStyle="rgba(255,255,255, 0.3)";this.context.stroke()};i.prototype.drawText=function(){var a;this.context.textAlign="center";this.context.fillStyle=this.options.text.textColor;this.context.textBaseline="bottom";if(this.options.text.displayValue){a=this.points.width/3.5;this.context.font="bold "+a+"px helvetica";if(this.options.text.label&&this.options.text.label.length>0){this.context.fillText(this.options.text.label,this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/25);this.context.fillText(this.options.value+"%",this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/1.5)}else this.context.fillText(this.options.value+"%",this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/2.3)}else{a=this.points.width/2.5;this.context.font="bold "+a+"px helvetica";this.context.fillText(this.options.text.label,this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/1.8)}};i.prototype.getValueDegrees=function(){if(this.options.value)return this.options.value*3.6;var a=parseInt(this.element.getAttribute("data-value"),10);return a===100?359.9964:a*3.6};i.prototype.checkCanvas=function(){return!!this.element.getContext&&!!this.element.getContext("2d")};i.prototype.getPoints=function(){return{width:this.element.width,x:this.element.width/2,angle:{start:this.value===360?0:270*g,end:this.value===360?h:(this.value-90)*g}}};i.prototype.getLinesAndRadiuses=function(){var a=this.points.width/30,b=this.points.x-a/2,c=b,d=this.points.width/35,e=c*.8;return{shadowLine:a,shadowRadius:b,externalRadius:c,internalLine:d,internalRadius:e}};a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new i(this,b))})}})(jQuery,window,document);